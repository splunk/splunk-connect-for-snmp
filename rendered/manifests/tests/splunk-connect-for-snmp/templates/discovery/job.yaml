---
# Source: splunk-connect-for-snmp/templates/discovery/job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: release-name-splunk-connect-for-snmp-discovery
  labels:
    app.kubernetes.io/name: splunk-connect-for-snmp-discovery
    app.kubernetes.io/instance: release-name
    helm.sh/chart: splunk-connect-for-snmp-CURRENT-VERSION
    app.kubernetes.io/version: "CURRENT-VERSION"
    app.kubernetes.io/managed-by: Helm
spec:
  ttlSecondsAfterFinished: 300
  template:
    metadata:
      #

      labels:
        app.kubernetes.io/name: splunk-connect-for-snmp-discovery
        app.kubernetes.io/instance: release-name
    spec:
      containers:
        - name: splunk-connect-for-snmp-discovery
          image: "ghcr.io/splunk/splunk-connect-for-snmp/container:CURRENT-VERSION"
          imagePullPolicy: Always
          args:
              ["discovery"]
          env:
          - name: REDIS_URL
            value: redis://release-name-redis-master:6379/1
          - name: DISCOVERY_CONFIG_PATH
            value: /app/discovery/discovery-config.yaml
          - name: LOG_LEVEL
            value: INFO
          - name: CHAIN_OF_TASKS_EXPIRY_TIME
            value: "60"
          - name: CELERY_TASK_TIMEOUT
            value: "2400"
          volumeMounts:
            - name: discovery-config
              mountPath: "/app/discovery"
              readOnly: true
            - name: tmp
              mountPath: "/tmp/"
              readOnly: false

      volumes:
        # # You set volumes at the Pod level, then mount them into containers inside that Pod
        - name: discovery-config
          configMap:
            name: splunk-connect-for-snmp-discovery-config
            items:
              - key: "discovery-config.yaml"
                path: "discovery-config.yaml"
        - name: tmp
          emptyDir: {}
      restartPolicy: OnFailure
