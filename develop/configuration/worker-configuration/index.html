
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.2">
    
    
      
        <title>Worker - Splunk Connect for SNMP (SC4SNMP)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#worker-configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Splunk Connect for SNMP (SC4SNMP)" class="md-header__button md-logo" aria-label="Splunk Connect for SNMP (SC4SNMP)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Splunk Connect for SNMP (SC4SNMP)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Worker
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Splunk Connect for SNMP (SC4SNMP)" class="md-nav__button md-logo" aria-label="Splunk Connect for SNMP (SC4SNMP)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Splunk Connect for SNMP (SC4SNMP)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gettingstarted/splunk-requirements/" class="md-nav__link">
        Splunk Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gettingstarted/mk8s/k8s-microk8s/" class="md-nav__link">
        Platform Microk8s
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gettingstarted/sck-installation/" class="md-nav__link">
        Install Splunk OpenTelemetry Collector for Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gettingstarted/sc4snmp-installation/" class="md-nav__link">
        Install SC4SNMP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../ha/" class="md-nav__link">
        High Availability
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployment-configuration/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Polling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Polling" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Polling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../poller-configuration/" class="md-nav__link">
        Poller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scheduler-configuration/" class="md-nav__link">
        Scheduler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuring-profiles/" class="md-nav__link">
        Configuring Profiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuring-groups/" class="md-nav__link">
        Configuring Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../step-by-step-poll/" class="md-nav__link">
        Step by Step polling example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trap-configuration/" class="md-nav__link">
        Traps
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Worker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Worker
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#worker-types" class="md-nav__link">
    Worker types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worker-configuration-file" class="md-nav__link">
    Worker configuration file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worker-scaling" class="md-nav__link">
    Worker scaling
  </a>
  
    <nav class="md-nav" aria-label="Worker scaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#real-life-scenario-i-use-sc4snmp-for-only-trap-monitoring-i-want-to-use-my-resources-effectively" class="md-nav__link">
    Real life scenario: I use SC4SNMP for only trap monitoring, I want to use my resources effectively.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-life-scenario-i-have-a-significant-delay-in-polling" class="md-nav__link">
    Real life scenario: I have a significant delay in polling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i-have-autoscaling-enabled-and-experience-problems-with-mongo-and-redis-pod" class="md-nav__link">
    I have autoscaling enabled and experience problems with Mongo and Redis pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i-dont-know-how-to-set-autoscaling-parameters-and-how-many-replicas-i-need" class="md-nav__link">
    I don't know how to set autoscaling parameters and how many replicas I need
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worker-parameters" class="md-nav__link">
    Worker parameters
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mongo-configuration/" class="md-nav__link">
        Mongo DB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redis-configuration/" class="md-nav__link">
        Redis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../snmpv3-configuration/" class="md-nav__link">
        SNMPv3 configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sim-configuration/" class="md-nav__link">
        Splunk Infrastructure Monitoring
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../planning/" class="md-nav__link">
        Planning
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../security/" class="md-nav__link">
        Security
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../mib-request/" class="md-nav__link">
        Request MIB
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/" class="md-nav__link">
        Upgrade SC4SNMP
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../bestpractices/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../releases/" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          Offline Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Offline Installation" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Offline Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../offlineinstallation/offline-microk8s/" class="md-nav__link">
        Install Microk8s
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../offlineinstallation/offline-sck/" class="md-nav__link">
        Install Splunk OpenTelemetry Collector for Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../offlineinstallation/offline-sc4snmp/" class="md-nav__link">
        Install SC4SNMP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../small-environment/" class="md-nav__link">
        Lightweight installation
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#worker-types" class="md-nav__link">
    Worker types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worker-configuration-file" class="md-nav__link">
    Worker configuration file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worker-scaling" class="md-nav__link">
    Worker scaling
  </a>
  
    <nav class="md-nav" aria-label="Worker scaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#real-life-scenario-i-use-sc4snmp-for-only-trap-monitoring-i-want-to-use-my-resources-effectively" class="md-nav__link">
    Real life scenario: I use SC4SNMP for only trap monitoring, I want to use my resources effectively.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-life-scenario-i-have-a-significant-delay-in-polling" class="md-nav__link">
    Real life scenario: I have a significant delay in polling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i-have-autoscaling-enabled-and-experience-problems-with-mongo-and-redis-pod" class="md-nav__link">
    I have autoscaling enabled and experience problems with Mongo and Redis pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i-dont-know-how-to-set-autoscaling-parameters-and-how-many-replicas-i-need" class="md-nav__link">
    I don't know how to set autoscaling parameters and how many replicas I need
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worker-parameters" class="md-nav__link">
    Worker parameters
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="worker-configuration">Worker Configuration<a class="headerlink" href="#worker-configuration" title="Permanent link">&para;</a></h1>
<p>The <code>worker</code> is a kubernetes pod which is responsible for the actual execution of polling, processing trap messages, and sending 
data to Splunk.</p>
<h3 id="worker-types">Worker types<a class="headerlink" href="#worker-types" title="Permanent link">&para;</a></h3>
<p>SC4SNMP has two base functionalities: monitoring traps and polling. These operations are handled by 3 types of workers:</p>
<ol>
<li>
<p>The <code>trap</code> worker consumes all the trap related tasks produced by the trap pod. </p>
</li>
<li>
<p>The <code>poller</code> worker consumes all the tasks related to polling.</p>
</li>
<li>
<p>The <code>sender</code> worker handles sending data to Splunk. You need to always have at least one sender pod running.</p>
</li>
</ol>
<h3 id="worker-configuration-file">Worker configuration file<a class="headerlink" href="#worker-configuration-file" title="Permanent link">&para;</a></h3>
<p>Worker configuration is kept in the <code>values.yaml</code> file in the <code>worker</code> section. <code>worker</code> has 3 subsections: <code>poller</code>, <code>sender</code>, or <code>trap</code>, that refer to the workers&rsquo; types.
<code>values.yaml</code> is used during the installation process for configuring Kubernetes values.
The <code>worker</code> default configuration is:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">worker</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># There are 3 types of workers </span><span class="w"></span>
<span class="w">  </span><span class="nt">trap</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># replicaCount: number of trap-worker pods which consumes trap tasks</span><span class="w"></span>
<span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">    </span><span class="c1">#autoscaling: use it instead of replicaCount in order to make pods scalable by itself</span><span class="w"></span>
<span class="w">    </span><span class="c1">#autoscaling:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  enabled: true</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  minReplicas: 2</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  maxReplicas: 10</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  targetCPUUtilizationPercentage: 80</span><span class="w"></span>
<span class="w">  </span><span class="nt">poller</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># replicaCount: number of poller-worker pods which consumes polling tasks</span><span class="w"></span>
<span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">    </span><span class="c1">#autoscaling: use it instead of replicaCount in order to make pods scalable by itself</span><span class="w"></span>
<span class="w">    </span><span class="c1">#autoscaling:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  enabled: true</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  minReplicas: 2</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  maxReplicas: 10</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  targetCPUUtilizationPercentage: 80</span><span class="w"></span>
<span class="w">  </span><span class="nt">sender</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># replicaCount: number of sender-worker pods which consumes sending tasks</span><span class="w"></span>
<span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">    </span><span class="c1"># autoscaling: use it instead of replicaCount in order to make pods scalable by itself</span><span class="w"></span>
<span class="w">    </span><span class="c1">#autoscaling:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  enabled: true</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  minReplicas: 2</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  maxReplicas: 10</span><span class="w"></span>
<span class="w">    </span><span class="c1">#  targetCPUUtilizationPercentage: 80</span><span class="w"></span>
<span class="w">  </span><span class="c1"># udpConnectionTimeout: timeout in seconds for SNMP operations</span><span class="w"></span>
<span class="w">  </span><span class="c1">#udpConnectionTimeout: 5</span><span class="w"></span>
<span class="w">  </span><span class="nt">logLevel</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;INFO&quot;</span><span class="w"></span>
</code></pre></div>

<p>All parameters are described in the <a href="#worker-parameters">Worker parameters</a> section.</p>
<h3 id="worker-scaling">Worker scaling<a class="headerlink" href="#worker-scaling" title="Permanent link">&para;</a></h3>
<p>You can adjust worker pods in two ways: set fixed value in <code>replicaCount</code>,
or enable <code>autoscaling</code>, which scales pods automatically. </p>
<h4 id="real-life-scenario-i-use-sc4snmp-for-only-trap-monitoring-i-want-to-use-my-resources-effectively">Real life scenario: I use SC4SNMP for only trap monitoring, I want to use my resources effectively.<a class="headerlink" href="#real-life-scenario-i-use-sc4snmp-for-only-trap-monitoring-i-want-to-use-my-resources-effectively" title="Permanent link">&para;</a></h4>
<p>If you don&rsquo;t use polling at all, set <code>worker.poller.replicaCount</code> to <code>0</code>.
If you&rsquo;ll want to use polling in the future, you need to increase <code>replicaCount</code>. To monitor traps, adjust <code>worker.trap.replicaCount</code> depending on your needs and <code>worker.sender.replicaCount</code> to send traps to Splunk. Usually you need much less sender pods than trap ones.</p>
<p>This is the example of <code>values.yaml</code> without using autoscaling:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">worker</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">trap</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<span class="w">  </span><span class="nt">sender</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">poller</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"></span>
<span class="w">  </span><span class="nt">logLevel</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WARNING&quot;</span><span class="w"></span>
</code></pre></div>

<p>This is the example of <code>values.yaml</code> with autoscaling:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">worker</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">trap</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">autoscaling</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<span class="w">      </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetCPUUtilizationPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="w">  </span><span class="nt">sender</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">autoscaling</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">      </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetCPUUtilizationPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="w">  </span><span class="nt">poller</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"></span>
<span class="w">  </span><span class="nt">logLevel</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WARNING&quot;</span><span class="w"></span>
</code></pre></div>

<p>In the example above both trap and sender pods are autoscaled. During an upgrade process, the number of pods is created through
<code>minReplicas</code>, and then new ones are created only if the CPU threshold
exceeds the <code>targetCPUUtilizationPercentage</code>, which by default is 80%. This solution helps you to keep 
resources usage adjusted to what you actually need. </p>
<p>After helm upgrade process, you will see <code>horizontalpodautoscaler</code> in <code>microk8s kubectl get all -n sc4snmp</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">NAME                                                                             REFERENCE                                               TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">horizontalpodautoscaler.autoscaling/snmp-mibserver                               Deployment/snmp-mibserver                               1%/80%    1         3         1          97m</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">horizontalpodautoscaler.autoscaling/snmp-splunk-connect-for-snmp-worker-sender   Deployment/snmp-splunk-connect-for-snmp-worker-sender   1%/80%    2         5         2          28m</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">horizontalpodautoscaler.autoscaling/snmp-splunk-connect-for-snmp-worker-trap     Deployment/snmp-splunk-connect-for-snmp-worker-trap     1%/80%    4         10        4          28m</span><span class="w"></span>
</code></pre></div>

<p>If you see <code>&lt;unknown&gt;/80%</code> in <code>TARGETS</code> section instead of the CPU percentage, you probably don&rsquo;t have the <code>metrics-server</code> add-on enabled.
Enable it using <code>microk8s enable metrics-server</code>.</p>
<h4 id="real-life-scenario-i-have-a-significant-delay-in-polling">Real life scenario: I have a significant delay in polling<a class="headerlink" href="#real-life-scenario-i-have-a-significant-delay-in-polling" title="Permanent link">&para;</a></h4>
<p>Sometimes when polling is configured to be run frequently and on many devices, workers get overloaded 
and there is a delay in delivering data to Splunk. To avoid such situations, we can scale poller and sender pods.
Because of the walk cycles (walk is a costly operation ran once in a while), poller workers require more resources 
for a short time. For this reason, enabling autoscaling is recommended. </p>
<p>This is the example of <code>values.yaml</code> with autoscaling:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">worker</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">trap</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">autoscaling</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<span class="w">      </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetCPUUtilizationPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="w">  </span><span class="nt">sender</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">autoscaling</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">      </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetCPUUtilizationPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="w">  </span><span class="nt">poller</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">autoscaling</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">      </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetCPUUtilizationPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="w">  </span><span class="nt">logLevel</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WARNING&quot;</span><span class="w"></span>
</code></pre></div>

<p>Remember, that the system won&rsquo;t scale itself infinitely, there is a finite amount of resources that you can allocate.
By default, every worker has configured the following resources:</p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">limits</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500m</span><span class="w"></span>
<span class="w">      </span><span class="nt">requests</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">250m</span><span class="w"></span>
</code></pre></div>

<h4 id="i-have-autoscaling-enabled-and-experience-problems-with-mongo-and-redis-pod">I have autoscaling enabled and experience problems with Mongo and Redis pod<a class="headerlink" href="#i-have-autoscaling-enabled-and-experience-problems-with-mongo-and-redis-pod" title="Permanent link">&para;</a></h4>
<p>If MongoDB and Redis pods are crushing, and some of the pods are in infinite <code>Pending</code> state, that means 
you&rsquo;re over your resources and SC4SNMP cannot scale more. You should decrease the number of <code>maxReplicas</code> in 
workers, so that it&rsquo;s not going beyond the available CPU.</p>
<h4 id="i-dont-know-how-to-set-autoscaling-parameters-and-how-many-replicas-i-need">I don&rsquo;t know how to set autoscaling parameters and how many replicas I need<a class="headerlink" href="#i-dont-know-how-to-set-autoscaling-parameters-and-how-many-replicas-i-need" title="Permanent link">&para;</a></h4>
<p>The best way to see if pods are overloaded is to run:</p>
<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">microk8s kubectl top pods -n sc4snmp</span><span class="w"></span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">NAME                                                          CPU(cores)   MEMORY(bytes)</span><span class="w">   </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-mibserver-7f879c5b7c-nnlfj                               1m           3Mi</span><span class="w">             </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-mongodb-869cc8586f-q8lkm                                 18m          225Mi</span><span class="w">           </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-redis-master-0                                           10m          2Mi</span><span class="w">             </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-splunk-connect-for-snmp-scheduler-558dccfb54-nb97j       2m           136Mi</span><span class="w">           </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-splunk-connect-for-snmp-trap-5878f89bbf-24wrz            2m           129Mi</span><span class="w">           </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-splunk-connect-for-snmp-trap-5878f89bbf-z9gd5            2m           129Mi</span><span class="w">           </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-splunk-connect-for-snmp-worker-poller-599c7fdbfb-cfqjm   260m         354Mi</span><span class="w">           </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-splunk-connect-for-snmp-worker-poller-599c7fdbfb-ztf7l   312m         553Mi</span><span class="w">           </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-splunk-connect-for-snmp-worker-sender-579f796bbd-vmw88   14m           257Mi</span><span class="w">           </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-splunk-connect-for-snmp-worker-trap-5474db6fc6-46zhf     3m           259Mi</span><span class="w">           </span>
<span class="l l-Scalar l-Scalar-Plain">snmp-splunk-connect-for-snmp-worker-trap-5474db6fc6-mjtpv     4m           259Mi</span><span class="w">   </span>
</code></pre></div>

<p>Here you can see how much CPU and Memory is being used by the pods. If the CPU is close to 500m (which is the limit for one pod by default),
you should enable autoscaling/increase maxReplicas or increase replicaCount with autoscaling off.</p>
<p>Here you can read about Horizontal Autoscaling and how to adjust maximum replica value to the resources you have: <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">Horizontal Autoscaling.</a></p>
<h3 id="worker-parameters">Worker parameters<a class="headerlink" href="#worker-parameters" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>variable</th>
<th>description</th>
<th>default</th>
</tr>
</thead>
<tbody>
<tr>
<td>worker.taskTimeout</td>
<td>task timeout in seconds (usually necessary when walk process takes a long time)</td>
<td>2400</td>
</tr>
<tr>
<td>worker.walkRetryMaxInterval</td>
<td>maximum time interval between walk attempts</td>
<td>600</td>
</tr>
<tr>
<td>worker.poller.replicaCount</td>
<td>number of poller worker replicas</td>
<td>2</td>
</tr>
<tr>
<td>worker.poller.autoscaling.enabled</td>
<td>enabling autoscaling for poller worker pods</td>
<td>false</td>
</tr>
<tr>
<td>worker.poller.autoscaling.minReplicas</td>
<td>minimum number of running poller worker pods when autoscaling is enabled</td>
<td>2</td>
</tr>
<tr>
<td>worker.poller.autoscaling.maxReplicas</td>
<td>maximum number of running poller worker pods when autoscaling is enabled</td>
<td>40</td>
</tr>
<tr>
<td>worker.poller.autoscaling.targetCPUUtilizationPercentage</td>
<td>CPU % threshold that must be exceeded on poller worker pods to spawn another replica</td>
<td>80</td>
</tr>
<tr>
<td>worker.poller.resources.limits</td>
<td>the resources limits for poller worker container</td>
<td>{}</td>
</tr>
<tr>
<td>worker.poller.resources.requests</td>
<td>the requested resources for poller worker container</td>
<td>{}</td>
</tr>
<tr>
<td>worker.trap.replicaCount</td>
<td>number of trap worker replicas</td>
<td>2</td>
</tr>
<tr>
<td>worker.trap.autoscaling.enabled</td>
<td>enabling autoscaling for trap worker pods</td>
<td>false</td>
</tr>
<tr>
<td>worker.trap.autoscaling.minReplicas</td>
<td>minimum number of running trap worker pods when autoscaling is enabled</td>
<td>2</td>
</tr>
<tr>
<td>worker.trap.autoscaling.maxReplicas</td>
<td>maximum number of running trap worker pods when autoscaling is enabled</td>
<td>40</td>
</tr>
<tr>
<td>worker.trap.autoscaling.targetCPUUtilizationPercentage</td>
<td>CPU % threshold that must be exceeded on trap worker pods to spawn another replica</td>
<td>80</td>
</tr>
<tr>
<td>worker.trap.resources.limits</td>
<td>the resources limits for poller worker container</td>
<td>{}</td>
</tr>
<tr>
<td>worker.trap.resources.requests</td>
<td>the requested resources for poller worker container</td>
<td>{}</td>
</tr>
<tr>
<td>worker.sender.replicaCount</td>
<td>number of sender worker replicas</td>
<td>2</td>
</tr>
<tr>
<td>worker.sender.autoscaling.enabled</td>
<td>enabling autoscaling for sender worker pods</td>
<td>false</td>
</tr>
<tr>
<td>worker.sender.autoscaling.minReplicas</td>
<td>minimum number of running sender worker pods when autoscaling is enabled</td>
<td>2</td>
</tr>
<tr>
<td>worker.sender.autoscaling.maxReplicas</td>
<td>maximum number of running sender worker pods when autoscaling is enabled</td>
<td>40</td>
</tr>
<tr>
<td>worker.sender.autoscaling.targetCPUUtilizationPercentage</td>
<td>CPU % threshold that must be exceeded on sender worker pods to spawn another replica</td>
<td>80</td>
</tr>
<tr>
<td>worker.sender.resources.limits</td>
<td>the resources limits for poller worker container</td>
<td>{}</td>
</tr>
<tr>
<td>worker.sender.resources.requests</td>
<td>the requested resources for poller worker container</td>
<td>{}</td>
</tr>
</tbody>
</table>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../trap-configuration/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Traps" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Traps
            </div>
          </div>
        </a>
      
      
        
        <a href="../mongo-configuration/" class="md-footer__link md-footer__link--next" aria-label="Next: Mongo DB" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Mongo DB
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <p>Webpages built on GitHub Pages | <a href="https://docs.github.com/en/site-policy/github-terms/github-terms-of-service">Github Terms</a> | <a href="https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement">GitHub Privacy</a></p>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
        <script src="../../javascripts/footer.js"></script>
      
    
  </body>
</html>